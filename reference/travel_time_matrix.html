<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Calculate travel time matrix between origin destination pairs — travel_time_matrix • r5r</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Calculate travel time matrix between origin destination pairs — travel_time_matrix" />
<meta property="og:description" content="Fast computation of travel time estimates between one or
multiple origin destination pairs." />
<meta property="og:image" content="/logo.png" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">r5r</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3-3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/calculating_isochrones.html">Calculating and visualizing Isochrones</a>
    </li>
    <li>
      <a href="../articles/intro_to_r5r.html">Intro to r5r: Rapid Realistic Routing with R5 in R</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/ipeaGIT/r5r/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Calculate travel time matrix between origin destination pairs</h1>
    <small class="dont-index">Source: <a href='https://github.com/ipeaGIT/r5r/tree/master/r-package/R/travel_time_matrix.R'><code>R/travel_time_matrix.R</code></a></small>
    <div class="hidden name"><code>travel_time_matrix.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Fast computation of travel time estimates between one or
multiple origin destination pairs.</p>
    </div>

    <pre class="usage"><span class='fu'>travel_time_matrix</span><span class='op'>(</span>
  <span class='va'>r5r_core</span>,
  <span class='va'>origins</span>,
  <span class='va'>destinations</span>,
  mode <span class='op'>=</span> <span class='st'>"WALK"</span>,
  mode_egress <span class='op'>=</span> <span class='st'>"WALK"</span>,
  departure_datetime <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Sys.time.html'>Sys.time</a></span><span class='op'>(</span><span class='op'>)</span>,
  time_window <span class='op'>=</span> <span class='fl'>1L</span>,
  percentiles <span class='op'>=</span> <span class='fl'>50L</span>,
  max_walk_dist <span class='op'>=</span> <span class='cn'>Inf</span>,
  max_trip_duration <span class='op'>=</span> <span class='fl'>120L</span>,
  walk_speed <span class='op'>=</span> <span class='fl'>3.6</span>,
  bike_speed <span class='op'>=</span> <span class='fl'>12</span>,
  max_rides <span class='op'>=</span> <span class='fl'>3</span>,
  n_threads <span class='op'>=</span> <span class='cn'>Inf</span>,
  verbose <span class='op'>=</span> <span class='cn'>TRUE</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>r5r_core</th>
      <td><p>a rJava object to connect with R5 routing engine</p></td>
    </tr>
    <tr>
      <th>origins, destinations</th>
      <td><p>a spatial sf POINT object, or a data.frame
containing the columns 'id', 'lon', 'lat'</p></td>
    </tr>
    <tr>
      <th>mode</th>
      <td><p>string. Transport modes allowed for the trips. Defaults to
"WALK". See details for other options.</p></td>
    </tr>
    <tr>
      <th>mode_egress</th>
      <td><p>string. Transport mode used after egress from public
transport. It can be either 'WALK', 'BICYCLE', or 'CAR'.
Defaults to "WALK".</p></td>
    </tr>
    <tr>
      <th>departure_datetime</th>
      <td><p>POSIXct object. If working with public transport
networks, please check <code>calendar.txt</code> within
the GTFS file for valid dates.</p></td>
    </tr>
    <tr>
      <th>time_window</th>
      <td><p>numeric. Time window in minutes for which r5r will
calculate multiple travel time matrices departing each
minute. By default, the number of simulations is 5 times
the size of 'time_window' set by the user. Defaults window
size to '1', the function only considers 5 departure times.
This parameter is only used with frequency-based GTFS files.
See details for further information.</p></td>
    </tr>
    <tr>
      <th>percentiles</th>
      <td><p>numeric vector. Defaults to '50', returning the median
travel time for a given time_window. If a numeric vector is passed,
for example c(25, 50, 75), the function will return
additional columns with the travel times within percentiles
of trips. For example, if the 25 percentile of trips between
A and B is 15 minutes, this means that 25% of all trips
taken between A and B within the set time window are shorter
than 15 minutes. Only the first 5 cut points of the percentiles
are considered. For more details, see R5 documentation at
'https://docs.conveyal.com/analysis/methodology#accounting-for-variability'</p></td>
    </tr>
    <tr>
      <th>max_walk_dist</th>
      <td><p>numeric. Maximum walking distance (in meters) for the
whole trip. Defaults to no restrictions on walking, as
long as <code>max_trip_duration</code> is respected.</p></td>
    </tr>
    <tr>
      <th>max_trip_duration</th>
      <td><p>numeric. Maximum trip duration in minutes. Defaults
to 120 minutes (2 hours).</p></td>
    </tr>
    <tr>
      <th>walk_speed</th>
      <td><p>numeric. Average walk speed in km/h. Defaults to 3.6 km/h.</p></td>
    </tr>
    <tr>
      <th>bike_speed</th>
      <td><p>numeric. Average cycling speed in km/h. Defaults to 12 km/h.</p></td>
    </tr>
    <tr>
      <th>max_rides</th>
      <td><p>numeric. The max number of public transport rides allowed in
the same trip. Defaults to 3.</p></td>
    </tr>
    <tr>
      <th>n_threads</th>
      <td><p>numeric. The number of threads to use in parallel computing.
Defaults to use all available threads (Inf).</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>logical. TRUE to show detailed output messages (the default)
or FALSE to show only eventual ERROR messages.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A data.table with travel time estimates (in minutes) between origin
destination pairs by a given transport mode. Note that origins/destinations
that were beyond the maximum travel time, and/or origins that were far from
the street network are not returned in the data.table.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>R5 allows for multiple combinations of transport modes. The options
include:</p><h3 class='hasAnchor' id='arguments'><a class='anchor' href='#arguments'></a>Transit modes</h3>


<p>TRAM, SUBWAY, RAIL, BUS, FERRY, CABLE_CAR, GONDOLA, FUNICULAR. The option
'TRANSIT' automatically considers all public transport modes available.</p>

<h3 class='hasAnchor' id='arguments'><a class='anchor' href='#arguments'></a>Non transit modes</h3>


<p>WALK, BICYCLE, CAR, BICYCLE_RENT, CAR_PARK</p>

    <h2 class="hasAnchor" id="routing-algorithm-"><a class="anchor" href="#routing-algorithm-"></a>Routing algorithm:</h2>

    <p>The travel_time_matrix function uses an R5-specific extension to the RAPTOR
routing algorithm (see Conway et al., 2017). This RAPTOR extension uses a
systematic sample of one departure per minute over the time window set by the
user in the 'time_window' parameter. A detailed description of base RAPTOR
can be found in Delling et al (2015).</p><ul>
<li><p>Conway, M. W., Byrd, A., &amp; van der Linden, M. (2017). Evidence-based transit
and land use sketch planning using interactive accessibility methods on
combined schedule and headway-based networks. Transportation Research Record,
2653(1), 45-53.</p></li>
<li><p>Delling, D., Pajor, T., &amp; Werneck, R. F. (2015). Round-based public transit
routing. Transportation Science, 49(3), 591-604.</p></li>
</ul>

    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>Other routing: 
<code><a href='detailed_itineraries.html'>detailed_itineraries</a>()</code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><span class='co'># \donttest{</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/ipeaGIT/r5r'>r5r</a></span><span class='op'>)</span>

<span class='co'># build transport network</span>
<span class='va'>data_path</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/system.file.html'>system.file</a></span><span class='op'>(</span><span class='st'>"extdata/spo"</span>, package <span class='op'>=</span> <span class='st'>"r5r"</span><span class='op'>)</span>
<span class='va'>r5r_core</span> <span class='op'>&lt;-</span> <span class='fu'><a href='setup_r5.html'>setup_r5</a></span><span class='op'>(</span>data_path <span class='op'>=</span> <span class='va'>data_path</span><span class='op'>)</span>

<span class='co'># load origin/destination points</span>
<span class='va'>points</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/utils/read.table.html'>read.csv</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='va'>data_path</span>, <span class='st'>"spo_hexgrid.csv"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>5</span>,<span class='op'>]</span>

<span class='va'>departure_datetime</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/as.POSIXlt.html'>as.POSIXct</a></span><span class='op'>(</span><span class='st'>"13-05-2019 14:00:00"</span>, format <span class='op'>=</span> <span class='st'>"%d-%m-%Y %H:%M:%S"</span><span class='op'>)</span>

<span class='co'># estimate travel time matrix</span>
<span class='va'>ttm</span> <span class='op'>&lt;-</span> <span class='fu'>travel_time_matrix</span><span class='op'>(</span><span class='va'>r5r_core</span>,
                          origins <span class='op'>=</span> <span class='va'>points</span>,
                          destinations <span class='op'>=</span> <span class='va'>points</span>,
                          mode <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"WALK"</span>, <span class='st'>"TRANSIT"</span><span class='op'>)</span>,
                          departure_datetime <span class='op'>=</span> <span class='va'>departure_datetime</span>,
                          max_walk_dist <span class='op'>=</span> <span class='cn'>Inf</span>,
                          max_trip_duration <span class='op'>=</span> <span class='fl'>120L</span><span class='op'>)</span>

<span class='fu'><a href='stop_r5.html'>stop_r5</a></span><span class='op'>(</span><span class='va'>r5r_core</span><span class='op'>)</span>

<span class='co'># }</span>
</pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Marcus Saraiva, Rafael H. M. Pereira, Daniel Herszenhut, Carlos Kaue Vieira Braga, Ipea - Institue for Applied Economic Research.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


